var controllCI,$=window.Zepto,curIndex=0,root=window.player,myAudio=new root.audioControll,$scope=$(document.body);function bindEvent(n){function t(){$(".song-list").css("bottom","-310px"),$(".mask").css("display","none"),$(".mask").off("click",t)}$scope.on("play:change",function(o,t){myAudio.getAudio(n[t].audio),root.process.randerAllTime(n[t].duration),root.rander(n[t],n),"play"==myAudio.status?(myAudio.play(),root.process.stop(),root.process.reload(),root.process.start()):root.process.reload()}),$(".icon-prev").on("click",function(o){o.stopPropagation(),curIndex=controllCI.pre(),$scope.trigger("play:change",curIndex)}),$(".icon-next").on("click",function(o){o.stopPropagation(),curIndex=controllCI.next(),$scope.trigger("play:change",curIndex)}),$(".icon-play").on("click",function(o){o.stopPropagation(),o.stopPropagation(),"play"==myAudio.status?(myAudio.pause(),root.process.stop()):(myAudio.play(),root.process.start()),$(this).toggleClass("icon-pause")}),$(".icon-list").on("click",function(o){o.stopPropagation(),$(".song-list").css("bottom","0"),$(".mask").css("display","block"),$(".mask").on("click",t)}),$(".list-close").on("click",function(o){o.stopPropagation(),$(".song-list").css("bottom","-310px"),$(".mask").css("display","none"),$(".mask").off("click",t)}),$(".list-des").on("click","li",function(o){o.stopPropagation();var t=$(this).index();t!=curIndex&&(curIndex=t,controllCI.index=t,"pause"==myAudio.status&&(myAudio.play(),root.process.stop(),$(".icon-play").toggleClass("icon-pause")),$scope.trigger("play:change",curIndex))})}function touchEvent(){var t,n,c,s,o=$(".bottom-line").offset(),e=o.left,i=o.width,a=0,r=$(".list-des-ul").offset().height,l=$(".list-des").offset().height-r;function u(){a=combine,$(".list-des-ul").off("touchend",u)}$(".list-des-ul").on("touchstart",function(o){c=o.changedTouches[0].clientY}).on("touchmove",function(o){s=o.changedTouches[0].clientY,combine=a+(s-c),0<combine?combine=0:combine<l&&(combine=l),$(".list-des-ul").css("transform","translateY("+combine+"px)"),$(".list-des-ul").on("touchend",u)}),$(".point").on("touchstart",function(o){root.process.stop()}).on("touchmove",function(o){t=o.changedTouches[0].clientX,(n=(t-e)/i)<0&&(n=0),1<n&&(n=1),root.process.update(n)}).on("touchend",function(o){t=o.changedTouches[0].clientX,(n=(t-e)/i)<0&&(n=0),1<n&&(n=1),root.process.lastPercent=n,"play"==myAudio.status?root.process.start():myAudio.playTo(myAudio.audio.duration*n),myAudio.playTo(myAudio.audio.duration*n)})}function getData(o){$.ajax({type:"GET",url:o,success:function(o){controllCI=new root.controllCI(o.length),bindEvent(o),$scope.trigger("play:change",curIndex),touchEvent()},error:function(){}})}getData("../mock/data.json");